---
title: 面试中跨域相关问题汇总
date: 2021-08-11
categories:
  - 面试
tags:
  - front-end
---

## 跨域请求的概念

- 同源策略：当两个网址的**协议**，**域名**，**端口**都一致的时候，我们称这两个网址是同源的
- 浏览器限制了脚本发起的资源请求 _（一般是 XHR 或 Fetch API）_ 只能发生在同源网址之间，如果本网页想要访问非同源网址的资源就会产生跨域请求

## 跨域请求发送出去了吗

- 对于简单请求，跨域请求发送出去了，只是结果被浏览器拦截了
- 对于非简单请求，由于预检过程的存在，真正的跨域请求没有发送出去

## 跨域请求的解决方案

- 目前最常用的 **CORS**：服务器端可以在 HTTP 响应头上通过 `Access-Control-Allow-(Origin/Headers/Methods/Credentials/)` 等响应头字段设置允许访问该资源的请求源，请求头，请求方法，是否允许携带 cookies 等
- webpack 提供的 **proxy**：仅适用于开发阶段
- Nginx 添加请求头：允许的源很难动态更改
- JSONP 具体操作看下面，存在的问题有：

  - 只允许 GET 请求，因此 URL 长度受限，不安全
  - 需要服务器端进行配合

## cors 方案中预检过程是什么样的？

- 提到**简单请求**和**非简单请求**，见 [MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS)，只有非简单请求才会触发预检过程
- 浏览器首先发出一个 OPTIONS 请求，包含非简单请求中存在的请求信息，如请求方法，请求头，源等等
- 服务器端返回它所允许的上述内容，并且如果预检请求能够通过就返回 200 响应
- 浏览器接收到响应后，再判断是否真正发出非简单请求

## jsonp 方案的大致流程是什么样的？

- 浏览器端声明需要执行的 callback 函数，比如叫 run
- 浏览器端动态生成 script 标签，将 src 属性指向目标 url 同时携带上参数 callback=run
- 服务器端接收到请求后将结果包装成 json 格式，同时返回字符串 run(json 格式的结果)
- 浏览器端接收到数据后就会执行相应的 run 函数

## nginx 和 webpack 代理方式的区别是什么？

- nginx 是通过为每一个 HTTP 响应添加上满足 CORS 要求的请求头实现的跨域，本质上请求还是通过浏览器发出的
- webpack 是通过内部发送请求的方式绕过浏览器获取到结果之后再返回给浏览器，本质上请求不是通过浏览器发出的
